<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Dashboard - NoteBridge</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    body.high-contrast {
      background-color: #000;
      color: #fff;
    }

    .font-small {
      font-size: 14px;
    }

    .font-medium {
      font-size: 18px;
    }

    .font-large {
      font-size: 22px;
    }

    ul {
      list-style-type: none;
      padding: 0;
    }

    li {
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .btn {
      padding: 5px 10px;
      cursor: pointer;
    }

    header,
    section,
    footer {
      margin-bottom: 20px;
    }

    #search-notes {
      margin-bottom: 10px;
      padding: 5px;
      width: 100%;
      max-width: 300px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    header img.logo {
      height: 50px;
      margin-right: 15px;
    }

    header .welcome {
      font-size: 18px;
      margin-left: 10px;
    }

    footer {
      text-align: center;
      font-size: 14px;
      color: #888;
      margin-top: 30px;
      border-top: 1px solid #ccc;
      padding-top: 10px;
    }

    button.tts-btn {
      margin-left: 5px;
    }

    .member-entry {
      display: flex;
      gap: 5px;
      margin-bottom: 5px;
      align-items: center;
    }
  </style>
</head>

<body class="font-medium">
  <header>
    <div style="display:flex; align-items:center;">
      <img src="{{ url_for('static', filename='logo.jpg') }}" alt="NoteBridge Logo" class="logo">
      <div class="welcome">Welcome, {{ user['full_name'] or user['username'] }}!</div>
    </div>
    <nav>
      <a href="{{ url_for('logout') }}" class="btn">Logout</a>
    </nav>
  </header>

  <!-- Accessibility controls -->
  <div aria-label="Accessibility settings" role="region" style="margin-bottom: 20px;">
    <label for="font-size">Font Size:</label>
    <select id="font-size" onchange="changeFontSize(this.value)">
      <option value="font-small">Small</option>
      <option value="font-medium" selected>Medium</option>
      <option value="font-large">Large</option>
    </select>

    <label for="contrast-toggle">High Contrast:</label>
    <input type="checkbox" id="contrast-toggle" onchange="toggleContrast(this.checked)">
  </div>

  <main style="display:flex; gap:40px;">
    <!-- Notebooks Section -->
    <section aria-label="Notebooks" role="region" style="flex:1;">
      <h2>Your Notebooks</h2>
      <input type="text" id="search-notes" placeholder="Search Notes..." oninput="filterNotes()">

      <ul id="notebook-list">
        {% for nb in notebooks %}
        <li>
          <a href="{{ url_for('view_notebook', notebook_id=nb['id']) }}"
            aria-label="Open collaborative editor for {{ nb['title'] }}">
            {{ nb['title'] }}
          </a>
          <button class="tts-btn" onclick="playNote('{{ nb['id'] }}')"
            aria-label="Play notes in {{ nb['title'] }}">üîä</button>
          <button class="tts-btn" onclick="stopNote()" aria-label="Stop reading {{ nb['title'] }}">‚èπ</button>
        </li>
        {% else %}
        <li>No notebooks yet.</li>
        {% endfor %}
      </ul>

      <form method="post" action="{{ url_for('create_notebook') }}">
        <input type="text" name="title" placeholder="New Notebook Title" aria-label="New notebook title">
        <label><input type="checkbox" name="is_shared"> Shared?</label>
        <button type="submit" class="btn">Create Notebook</button>
      </form>
    </section>

    <!-- Groups Section -->
    <section aria-label="Groups" role="region" style="flex:1;">
      <h2>Groups</h2>

      <!-- Existing groups -->
      <ul>
        {% for g in groups %}
        <li>
          <strong>{{ g['name'] }}</strong> ({{ g['members'] }} members)
          <a href="{{ url_for('view_group', group_id=g['id']) }}" class="btn">View</a>
          <a href="{{ url_for('edit_group', group_id=g['id']) }}" class="btn">Edit</a>
          <form method="post" action="{{ url_for('delete_group', group_id=g['id']) }}" style="display:inline">
            <button type="submit" class="btn">Delete</button>
          </form>
        </li>
        {% else %}
        <li>No groups yet.</li>
        {% endfor %}
      </ul>

      <!-- Create new group -->
      <form method="post" action="{{ url_for('create_group') }}">
        <input type="text" name="name" placeholder="Group Name" aria-label="Group Name" required>
        <div id="members-container">
          <h4>Members</h4>
          <div class="member-entry">
            <input type="text" name="member_name[]" placeholder="Name" required>
            <input type="text" name="member_id[]" placeholder="Student ID" required>
            <input type="text" name="member_course[]" placeholder="Course/Project" required>
            <button type="button" onclick="removeMember(this)">Remove</button>
          </div>
        </div>
        <button type="button" onclick="addMember()">Add Member</button>
        <button type="submit" class="btn">Create Group</button>
      </form>
    </section>
  </main>

  <footer>
    &copy; 2025 NoteBridge. All rights reserved.
  </footer>

  <script>
    // Accessibility
    function changeFontSize(sizeClass) {
      document.body.classList.remove('font-small', 'font-medium', 'font-large');
      document.body.classList.add(sizeClass);
    }

    function toggleContrast(enabled) {
      if (enabled) document.body.classList.add('high-contrast');
      else document.body.classList.remove('high-contrast');
    }

    // Search
    function filterNotes() {
      const query = document.getElementById('search-notes').value.toLowerCase();
      const notes = document.getElementById('notebook-list').getElementsByTagName('li');
      for (let note of notes) {
        const text = note.textContent.toLowerCase();
        note.style.display = text.includes(query) ? '' : 'none';
      }
    }

    // Text-to-Speech
    function playNote(notebookId) {
      fetch(`/get_notes_text/${notebookId}`)
        .then(response => response.json())
        .then(data => {
          const text = data.notes_text;
          if (!text) return alert("No notes to read!");
          stopNote(); // Stop any ongoing speech
          const utterance = new SpeechSynthesisUtterance(text);
          utterance.rate = 1;
          utterance.pitch = 1;
          speechSynthesis.speak(utterance);
        })
        .catch(err => console.error(err));
    }

    function stopNote() {
      if (speechSynthesis.speaking) {
        speechSynthesis.cancel();
      }
    }

    // Group members dynamic add/remove
    function addMember() {
      const container = document.getElementById('members-container');
      const entry = document.createElement('div');
      entry.className = 'member-entry';
      entry.innerHTML = `
        <input type="text" name="member_name[]" placeholder="Name" required>
        <input type="text" name="member_id[]" placeholder="Student ID" required>
        <input type="text" name="member_course[]" placeholder="Course/Project" required>
        <button type="button" onclick="removeMember(this)">Remove</button>
      `;
      container.appendChild(entry);
    }

    function removeMember(btn) {
      btn.parentElement.remove();
    }
  </script>
</body>

</html>